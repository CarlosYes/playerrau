<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Radio Globalmix - Central Player Pro</title>
    <style>
        :root { --accent: #00f2ff; --bg: #0a0a0a; }
        body { background: #1a1a1a; font-family: 'Arial', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; color: #fff; overflow: hidden; }

        .player-container {
            width: 700px; background: var(--bg); border-radius: 4px; padding: 25px;
            display: grid; grid-template-columns: 240px 1fr; gap: 20px; position: relative;
            box-shadow: 0 40px 80px rgba(0,0,0,0.9); border: 1px solid #222;
        }

        .top-banner { grid-column: 1 / -1; background: #000; padding: 10px; font-size: 11px; display: flex; justify-content: space-between; border-bottom: 2px solid var(--accent); color: #666; font-weight: bold; }

        #album-art { width: 240px; height: 240px; background: #000; border-radius: 4px; object-fit: cover; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        
        .stats-info { font-size: 11px; line-height: 1.8; color: #555; margin-top: 15px; }
        .stats-info b { color: #aaa; text-transform: uppercase; }

        .side-right { display: flex; flex-direction: column; justify-content: space-between; }
        .track-display h2 { font-size: 20px; margin: 0; color: #fff; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .track-display p { font-size: 16px; margin: 5px 0 15px; color: var(--accent); font-weight: bold; }
        
        .eq-box { background: #000; height: 100px; border-radius: 4px; display: flex; align-items: center; justify-content: center; }
        #visualizer { width: 100%; height: 80px; }

        .time-now { font-size: 42px; font-weight: bold; text-align: center; color: #fff; margin: 15px 0; font-family: 'Courier New', monospace; }

        .footer { grid-column: 1 / -1; display: flex; align-items: center; gap: 20px; border-top: 1px solid #222; padding-top: 20px; }
        .play-btn { width: 70px; height: 70px; border-radius: 50%; border: 3px solid #333; background: none; color: #fff; font-size: 26px; cursor: pointer; transition: 0.3s; }
        .play-btn:hover { border-color: var(--accent); color: var(--accent); transform: scale(1.05); }
        
        .vol-control { flex-grow: 1; display: flex; align-items: center; gap: 15px; font-size: 11px; color: #666; }
        input[type=range] { flex-grow: 1; accent-color: var(--accent); cursor: pointer; }

        .side-colors { position: absolute; right: -45px; top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; gap: 12px; }
        .dot { width: 22px; height: 22px; border-radius: 50%; cursor: pointer; border: 2px solid #333; transition: 0.2s; }
        .dot:hover { border-color: #fff; transform: scale(1.2); }
    </style>
</head>
<body>

<div class="player-container">
    <div class="top-banner">
        <span>Rádio Dos Amigos Unidos</span>
        <span id="b-track">CONECTANDO...</span>
    </div>

    <div class="side-left">
        <img id="album-art" src="https://i.postimg.cc/8kJqR7g4/Logo-RAU-(Completo-350x350).png" alt="Capa">
        <div class="stats-info">
            OUVINTES: <b id="val-listeners"> </b><br>
            GÊNERO: <b id="val-genre">VÁRIOS</b><br>
            BITRATE: <b id="val-bitrate">128</b> KBPS<br>
            STATUS: <b id="val-status">ONLINE</b>
        </div>
    </div>

    <div class="side-right">
        <div class="track-display">
            <h2 id="song-title"> </h2>
            <p id="artist-name">Rádio Dos Amigos Unidos</p>
        </div>

        <div class="eq-box">
            <canvas id="visualizer"></canvas>
        </div>

        <div class="time-now" id="clock">00:00:00</div>
    </div>

    <div class="footer">
        <button class="play-btn" id="playBtn">▶</button>
        <div class="vol-control">
            VOLUME <input type="range" id="volRange" min="0" max="1" step="0.01" value="0.8"> <span id="volPerc">80%</span>
        </div>
    </div>

    <div class="side-colors">
        <div class="dot" style="background: #00f2ff;" onclick="setTheme('#00f2ff')"></div>
        <div class="dot" style="background: #ff4d4d;" onclick="setTheme('#ff4d4d')"></div>
        <div class="dot" style="background: #a2ff00;" onclick="setTheme('#a2ff00')"></div>
        <div class="dot" style="background: #ffec00;" onclick="setTheme('#ffec00')"></div>
        <div class="dot" style="background: #ff00ea;" onclick="setTheme('#ff00ea')"></div>
    </div>
</div>

<script>
    // URL decodificada para o novo servidor sp0.redeaudio.com
    const _sU = "https://sp0.redeaudio.com:10822/;type=mp3";
    const _aU = "https://sp0.redeaudio.com:10822/stats?json=1";
    const _iU = "https://itunes.apple.com/search?term=";

    const audio = new Audio(_sU);
    audio.crossOrigin = "anonymous";
    const canvas = document.getElementById('visualizer');
    const ctx = canvas.getContext('2d');
    let audioCtx, analyser, source, dataArray;

    function setTheme(c) { document.documentElement.style.setProperty('--accent', c); }

    setInterval(() => {
        document.getElementById('clock').innerText = new Date().toLocaleTimeString();
    }, 1000);

    // Função de Metadados com Proxy AllOrigins para garantir o funcionamento
    async function updateMetadata() {
        const proxy = "https://api.allorigins.win/get?url=";
        try {
            const res = await fetch(proxy + encodeURIComponent(_aU));
            const jsonRaw = await res.json();
            const data = JSON.parse(jsonRaw.contents);
            
            const song = data.songtitle || "Radio Globalmix";
            const [art, tit] = song.split(' - ');
            
            document.getElementById('song-title').innerText = tit || song;
            document.getElementById('artist-name').innerText = art || "Radio";
            document.getElementById('b-track').innerText = song;
            document.getElementById('val-listeners').innerText = data.uniquelisteners || 0;
            document.getElementById('val-bitrate').innerText = data.bitrate || 128;

            // Busca Capa Automática
            const coverRes = await fetch(_iU + encodeURIComponent(song) + "&limit=1");
            const coverData = await coverRes.json();
            if(coverData.results[0]) {
                document.getElementById('album-art').src = coverData.results[0].artworkUrl100.replace('100x100', '600x600');
            }
        } catch(e) { 
            console.error("Metadados inacessíveis via Proxy."); 
        }
    }

    function initVisualizer() {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioCtx.createAnalyser();
        source = audioCtx.createMediaElementSource(audio);
        source.connect(analyser);
        analyser.connect(audioCtx.destination);
        analyser.fftSize = 128;
        dataArray = new Uint8Array(analyser.frequencyBinCount);
        render();
    }

    function render() {
        requestAnimationFrame(render);
        analyser.getByteFrequencyData(dataArray);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        const barWidth = 3;
        let x = 0;
        const midY = canvas.height / 2;

        for (let i = 0; i < dataArray.length; i++) {
            const h = (dataArray[i] / 255) * midY;
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--accent');
            ctx.fillRect(x, midY - h, barWidth, h * 2);
            x += barWidth + 4;
        }
    }

    document.getElementById('playBtn').onclick = () => {
        if(!audioCtx) initVisualizer();
        if(audio.paused) { 
            audio.play(); 
            document.getElementById('playBtn').innerText = 'II'; 
        } else { 
            audio.pause(); 
            document.getElementById('playBtn').innerText = '▶'; 
        }
    };

    document.getElementById('volRange').oninput = (e) => {
        audio.volume = e.target.value;
        document.getElementById('volPerc').innerText = Math.round(e.target.value * 100) + "%";
    };

    setInterval(updateMetadata, 15000);
    updateMetadata();
</script>
</body>
</html>